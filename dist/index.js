!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("XWatermark",[],e):"object"==typeof exports?exports.XWatermark=e():t.XWatermark=e()}(window,(function(){return function(t){var e={};function o(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=t,o.c=e,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(r,i,function(e){return t[e]}.bind(null,i));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){"use strict";function r(t,e,o){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var r=o.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}o.r(e),o.d(e,"XWatermark",(function(){return u}));var i="[XWatermark]",n={id:"",top:0,left:0,rows:0,cols:0,xSpace:50,ySpace:50,ratio:1,font:"Helvetica Neue, Arial, MS YaHei",weight:"normal",color:"black",fontsize:16,alpha:.1,angle:-15,zIndex:9999,width:"auto",height:"auto",mode:"n",parentNode:document.body,parentSelector:"",observer:!1,observerNode:null,prevent:!1};function s(t){var e=document.getElementById(t);if(e){try{var o=e.parentNode;return null==o||o.removeChild(e),!0}catch(e){console.warn(`${i} Remove watermark dom [${t}] failed:`,e)}return!1}return!0}function a(t,e){t.font=`${e.weight} ${e.fontsize}px ${e.font}`,t.fillStyle=e.color,t.textAlign="left",t.textBaseline="bottom"}var l=(t,e,o)=>{if(t){var r=o.id;s(r);var n=1.5*o.fontsize,l=o.xSpace,h=o.ySpace;["stagger","s","n"].includes(o.mode)&&(l=2*o.xSpace,h=2*o.ySpace);var u=document.createElement("canvas"),d=u.getContext("2d");if(null===d)return console.error(`${i} load error. Canvas Context is null. You'r browser may not support canvas.`),"";if(a(d,o),"string"==typeof o.width){var c=Number(o.width);if(isNaN(c)){if("auto"!==o.width)return console.warn(`${i} width is not a number or 'auto'. Please check your options.`),"";var p=d.measureText(e);o.width=p.width+n*Math.sin(Math.abs(o.angle)*Math.PI/180)}else o.width=c*o.ratio}if("string"==typeof o.height){var f=Number(o.height);if(isNaN(f)){if("auto"!==o.height)return console.warn(`${i} height is not a number or 'auto'. Please check your options.`),"";var v=((t,e,o)=>{for(var r=e.split(""),i="",n=0,s=0;s<r.length;s++){var a=i+r[s];t.measureText(a).width>o&&s>0?(n++,i=r[s]):i=a}return++n})(d,e,o.width);o.height=n*v+o.width*Math.sin(Math.abs(o.angle)*Math.PI/180)}else o.height=f*o.ratio}var b=window.devicePixelRatio||1;u.width=(o.width+l)*b,u.height=(o.height+h)*b,d.scale(b,b),a(d,o),function(t,e,o,r,i,n,s){t.save(),t.translate(o,r),t.rotate(s*Math.PI/180);for(var a=e.split(""),l=e.split("\n").reduce(((e,o)=>{var r=t.measureText(o);return Math.max(e,r.width)}),0),h="",u=0;u<a.length;u++){var d=h+a[u],c=t.measureText(d).width;if("\n"==a[u]){var p=(l-t.measureText(h).width)/2+10;t.fillText(h,p,0),t.translate(0,n),h=""}else if(c>i&&u>0){var f=(l-t.measureText(h).width)/2+10;t.fillText(h,f,0),t.translate(f,n),h=a[u]}else h=d}var v=(l-t.measureText(h).width)/2+10;t.fillText(h,v,0),t.translate(0,n),t.restore()}(d,e,0,(o.angle<0?1:0)*o.width*Math.sin(Math.abs(o.angle)*Math.PI/180)+.8*n,o.width,n,o.angle);var m=u.toDataURL("image/png");d.clearRect(0,0,u.width,u.height),d=null,u=null,t===document.body||""!==t.style.position&&"static"!==t.style.position||(t.style.position="relative");var y=document.createElement("div");y.id=r,y.style.pointerEvents="none",y.style.overflow="hidden",y.style.top="0",y.style.left="0",y.style.margin="0",y.style.padding="0",y.style.position=t===document.body?"fixed":"absolute",y.style.zIndex=`${o.zIndex}`,y.style.opacity=`${o.alpha}`,y.style.paddingTop=`${o.top}px`,y.style.paddingLeft=`${o.left}px`,y.style.width=(t.scrollWidth||document.documentElement.scrollWidth)-o.left+"px",y.style.height=(t.scrollHeight||document.documentElement.scrollHeight)-o.top+"px";var g=document.createElement("div");switch(g.style.width="100%",g.style.height="100%",g.style.margin="0",g.style.padding="0",g.style.backgroundImage=`url(${m})`,g.style.backgroundPosition="0 0",o.mode){case"horizontal":case"h":case"x":g.style.backgroundRepeat="repeat-x";break;case"vertical":case"v":case"y":g.style.backgroundRepeat="repeat-y";break;case"stagger":case"s":g.style.backgroundImage=`url(${m}), url(${m})`,g.style.backgroundRepeat="repeat, repeat",g.style.backgroundPosition=`0 0, ${(o.width+l)/2}px ${(o.height+h)/2}px`;break;default:g.style.backgroundRepeat="repeat"}return g.style.backgroundSize=`${o.width+l}px ${o.height+h}px`,y.appendChild(g),t.appendChild(y),m}console.error(`${i} Could not load watermark. Dom is null. content:`,e)};class h{constructor(t=null,e={}){if(r(this,"_observerObs",null),r(this,"_preventObs",null),r(this,"_targetNode",null),r(this,"base64",""),r(this,"content",""),r(this,"_options",Object.assign({},n)),r(this,"isDoing",!1),t)return this.init(t,e)}init(t,e={}){if(t){if(this._options=Object.assign({},n,{id:c()},e),this.content=t,this._targetNode=this._options.parentSelector?document.querySelector(this._options.parentSelector):this._options.parentNode,this._targetNode)return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>this._do())):this._do(),this.start(),this;console.warn(`${i} You have set 'options.parentSelector': (${this._options.parentSelector}), but it seems that the selector does not match any element. You may need to refresh manually or change/delete the selector param.`)}else console.error(`${i} You have not set the content of watermark.`)}reload(t,e){return this.remove(),t&&(this.content=t),e&&"object"==typeof e&&(this._options=Object.assign({},n,{id:c()},e)),this.init(this.content,this._options)}remove(){return this._dispose(),s(this._options.id)}start(){if(window.addEventListener("resize",(()=>this._do())),this._options.observer){var t=window.ResizeObserver||window.WebKitResizeObserver;if(t){this._observerObs=new t(d((t=>{this._do()})),300);var e=this._options.observerNode||this._targetNode;this._observerObs.observe(e,{attributes:!0})}else console.warn(`${i} You have set 'options.observer', but it seems that your current env does not support ResizeObserver. You may need to refresh manually.`)}if(this._options.prevent){var o=window.MutationObserver||window.WebKitMutationObserver;o?(this._preventObs=new o(d((t=>{this._do()}),300)),this._preventObs.observe(this._targetNode,{attributes:!0,subtree:!0,childList:!0,characterData:!0,attributeOldValue:!0,characterDataOldValue:!0})):console.warn(`${i} You have set 'options.prevent', but it seems that your current env does not support MutationObserver. You may need to do it manually.`)}}stop(){this._dispose()}_do(){var t=this;t.isDoing||(t.isDoing=!0,new Promise((t=>{"number"==typeof this._options.ratio&&1!==this._options.ratio&&(this._options.top*=this._options.ratio,this._options.left*=this._options.ratio,this._options.xSpace*=this._options.ratio,this._options.ySpace*=this._options.ratio,this._options.fontsize*=this._options.ratio,"number"==typeof this._options.width&&(this._options.width*=this._options.ratio),"number"==typeof this._options.height&&(this._options.height*=this._options.ratio)),this.base64=l(this._targetNode,this.content,this._options),t()})).finally((()=>{t.isDoing=!1})))}_dispose(){this._observerObs&&(this._observerObs.disconnect(),this._observerObs=null),this._preventObs&&(this._preventObs.disconnect(),this._preventObs=null),window.removeEventListener("resize",this._do)}}var u=h;function d(t,e){var o;return function(){var r=arguments;o||(t.apply(this,r),o=!0,setTimeout((()=>o=!1),e))}}function c(){return"x-watermark-"+Math.floor(16777215*Math.random()).toString(16).padStart(6,"0")}e.default=h}])}));